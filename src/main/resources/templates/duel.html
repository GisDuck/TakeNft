<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Duel Room</title>
    <link href="/css/style.css" type="text/css" rel="stylesheet">
    <script src="/js/initialize_header.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
    <style>
        #duel-stage {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 40px;
          margin: 0 clamp(20px, 10%, 80px);
        }

        .duel-column {
          flex: 1;
        }

        .duel-avatar {
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-bottom: 20px;
        }

        .duel-avatar img {
          width: 100px;
          height: 100px;
          border-radius: 50%;
          object-fit: cover;
          margin-bottom: 12px;
        }

        .duel-avatar h2 {
          font-size: 20px;
          font-weight: 700;
        }

        .inventory-box, .opponent-box {
          background: #D9D9D9;
          border-radius: 20px;
          padding: 20px;
          max-height: 270px;
          overflow-y: auto;
        }

        .inventory-grid, .opponent-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
          gap: 12px;
        }

        .nft-card {
          width: 100%;
          aspect-ratio: 1 / 1;
          border-radius: 16px;
          overflow: hidden;
          transition: border 0.2s;
          border: 2px solid transparent;
        }

        .nft-card img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }

        .nft-card.selected {
          border: 3px solid #79C3FF;
        }

        .save-container {
          text-align: center;
          margin-top: 40px;
        }

        #confirm-button {
          padding: 20px 40px;
          font-size: 18px;
          font-weight: bold;
          border-radius: 20px;
          cursor: pointer;
          transition: background .3s, color .3s;
          background: #000;
          color: #fff;
          border: none;
        }

        #confirm-button:hover {
          background: #79C3FF;
          color: #fff;
        }
    </style>
</head>
<body>
<div id="site-header"></div>
<div id="wrapper">
    <div id="content">
        <section id="duel-stage">
            <div class="duel-column">
                <div class="duel-avatar">
                    <img id="player-avatar" src="/img/default_avatar.png">
                    <h2 id="player-name">You</h2>
                </div>
                <div class="inventory-box">
                    <h3>Your Inventory</h3>
                    <div class="inventory-grid" id="inventory"></div>
                </div>
            </div>

            <div class="duel-column">
                <div class="duel-avatar">
                    <img id="opponent-avatar" src="/img/default_avatar.png">
                    <h2 id="opponent-name">Waiting...</h2>
                </div>
                <div class="opponent-box">
                    <h3>Opponent Selection</h3>
                    <div class="opponent-grid" id="opponent-selection"></div>
                </div>
            </div>
        </section>

        <div class="save-container">
            <button id="confirm-button">OK</button>
        </div>
    </div>
</div>

<script>
    const inventoryEl = document.getElementById('inventory');
    const confirmButton = document.getElementById('confirm-button');
    const selectedNFTs = new Set();

    const mockInventory = [
      { id: 1, imgUrl: '/img/nft1.png' },
      { id: 2, imgUrl: '/img/nft2.png' },
      { id: 3, imgUrl: '/img/nft3.png' },
      { id: 4, imgUrl: '/img/nft4.png' },
      { id: 5, imgUrl: '/img/nft5.png' },
      { id: 6, imgUrl: '/img/nft6.png' },
      { id: 7, imgUrl: '/img/nft7.png' }
    ];

    function renderInventory() {
      inventoryEl.innerHTML = '';
      mockInventory.forEach(nft => {
        const card = document.createElement('div');
        card.className = 'nft-card';
        card.dataset.id = nft.id;

        const img = document.createElement('img');
        img.src = nft.imgUrl;
        img.alt = 'NFT';

        card.appendChild(img);
        card.onclick = () => {
          if (selectedNFTs.has(nft.id)) {
            selectedNFTs.delete(nft.id);
            card.classList.remove('selected');
          } else {
            selectedNFTs.add(nft.id);
            card.classList.add('selected');
          }
        };
        inventoryEl.appendChild(card);
      });
    }

    renderInventory();

    confirmButton.onclick = () => {
      console.log('Selected NFTs:', Array.from(selectedNFTs));
      // TODO: send via WebSocket
    };
</script>
</body>
</html>
